const carts = [
    {
        id: 1,
        img: '1-2.png',
        clr: 'black',
        pos: 1,
    },
    {
        id: 2,
        img: '1-3.png',
        clr: 'black',
        pos: 2,
    },
    {
        id: 3,
        img: '1-4.png',
        clr: 'black',
        pos: 3,
    },
    {
        id: 4,
        img: '1-5.png',
        clr: 'black',
        pos: 4,
    },
    {
        id: 5,
        img: '1-6.png',
        clr: 'black',
        pos: 5,
    },
    {
        id: 6,
        img: '1-7.png',
        clr: 'black',
        pos: 6,
    },
    {
        id: 7,
        img: '1-8.png',
        clr: 'black',
        pos: 7,
    },
    {
        id: 8,
        img: '1-9.png',
        clr: 'black',
        pos: 8,
    },
    {
        id: 9,
        img: '1-10.png',
        clr: 'black',
        pos: 9,
    },
    {
        id: 10,
        img: '1-j.png',
        clr: 'black',
        pos: 10,
    },
    {
        id: 11,
        img: '1-q.png',
        clr: 'black',
        pos: 11,
    },
    {
        id: 12,
        img: '1-k.png',
        clr: 'black',
        pos: 12,
    },
    {
        id: 13,
        img: '1-t.png',
        clr: 'black',
        pos: 0,
    },
    
    {
        id: 14,
        img: '2-2.png',
        clr: 'black',
        pos: 1,
    },
    {
        id: 15,
        img: '2-3.png',
        clr: 'black',
        pos: 2,
    },
    {
        id: 16,
        img: '2-4.png',
        clr: 'black',
        pos: 3,
    },
    {
        id: 17,
        img: '2-5.png',
        clr: 'black',
        pos: 4,
    },
    {
        id: 18,
        img: '2-6.png',
        clr: 'black',
        pos: 5,
    },
    {
        id: 19,
        img: '2-7.png',
        clr: 'black',
        pos: 6,
    },
    {
        id: 20,
        img: '2-8.png',
        clr: 'black',
        pos: 7,
    },
    {
        id: 21,
        img: '2-9.png',
        clr: 'black',
        pos: 8,
    },
    {
        id: 22,
        img: '2-10.png',
        clr: 'black',
        pos: 9,
    },
    {
        id: 23,
        img: '2-j.png',
        clr: 'black',
        pos: 10,
    },
    {
        id: 24,
        img: '2-q.png',
        clr: 'black',
        pos: 11,
    },
    {
        id: 25,
        img: '2-k.png',
        clr: 'black',
        pos: 12,
    },
    {
        id: 26,
        img: '2-t.png',
        clr: 'black',
        pos: 0,
    },

    {
        id: 27,
        img: '3-2.png',
        clr: 'red',
        pos: 1,
    },
    {
        id: 28,
        img: '3-3.png',
        clr: 'red',
        pos: 2,
    },
    {
        id: 29,
        img: '3-4.png',
        clr: 'red',
        pos: 3,
    },
    {
        id: 30,
        img: '3-5.png',
        clr: 'red',
        pos: 4,
    },
    {
        id: 31,
        img: '3-6.png',
        clr: 'red',
        pos: 5,
    },
    {
        id: 32,
        img: '3-7.png',
        clr: 'red',
        pos: 6,
    },
    {
        id: 33,
        img: '3-8.png',
        clr: 'red',
        pos: 7,
    },
    {
        id: 34,
        img: '3-9.png',
        clr: 'red',
        pos: 8,
    },
    {
        id: 35,
        img: '3-10.png',
        clr: 'red',
        pos: 9,
    },
    {
        id: 36,
        img: '3-j.png',
        clr: 'red',
        pos: 10,
    },
    {
        id: 37,
        img: '3-q.png',
        clr: 'red',
        pos: 11,
    },
    {
        id: 38,
        img: '3-k.png',
        clr: 'red',
        pos: 12,
    },
    {
        id: 39,
        img: '3-t.png',
        clr: 'red',
        pos: 0,
    },

    {
        id: 40,
        img: '4-2.png',
        clr: 'red',
        pos: 1,
    },
    {
        id: 41,
        img: '4-3.png',
        clr: 'red',
        pos: 2,
    },
    {
        id: 42,
        img: '4-4.png',
        clr: 'red',
        pos: 3,
    },
    {
        id: 43,
        img: '4-5.png',
        clr: 'red',
        pos: 4,
    },
    {
        id: 44,
        img: '4-6.png',
        clr: 'red',
        pos: 5,
    },
    {
        id: 45,
        img: '4-7.png',
        clr: 'red',
        pos: 6,
    },
    {
        id: 46,
        img: '4-8.png',
        clr: 'red',
        pos: 7,
    },
    {
        id: 47,
        img: '4-9.png',
        clr: 'red',
        pos: 8,
    },
    {
        id: 48,
        img: '4-10.png',
        clr: 'red',
        pos: 9,
    },
    {
        id: 49,
        img: '4-j.png',
        clr: 'red',
        pos: 10,
    },
    {
        id: 50,
        img: '4-q.png',
        clr: 'red',
        pos: 11,
    },
    {
        id: 51,
        img: '4-k.png',
        clr: 'red',
        pos: 12,
    },
    {
        id: 52,
        img: '4-t.png',
        clr: 'red',
        pos: 0,
    },
]

const app = new Vue({
    el: '#app',
    data: {
        carts,
        conmpletaarr: [
            [],[],[],[]
        ],
        gamearr: [
            [],[],[],[],[],[],[]
        ],
        choicearr: [
            [],
            []
        ],
        currentcard: {},
        cpos: {
            x: 0,
            y: 0,
            z: 0,
        },
        hascurrentcard: false,
    },
    methods: {
        shufflegame(arr){
            let currentind = arr.length, randind;

            while(currentind != 0){
                randind = Math.floor(Math.random() * currentind);
                currentind--;
                [arr[currentind], arr[randind]] = [arr[randind], arr[currentind]]
            }
            return arr;
        },
        choicecart(){
            if(this.choicearr[0].length === 0){
                this.clearcurrent();
                for(let i=this.choicearr[1].length-1;i>=0;i--){
                    this.choicearr[0].push(this.choicearr[1][i]);
                    this.choicearr[1].pop();
                }
            }else{
                this.clearcurrent();
                this.choicearr[1].push(this.choicearr[0][this.choicearr[0].length - 1])
                this.choicearr[0].pop();
            }
        },
        clearcurrent(){
            this.currentcard = {};
            this.cpos = {
                x: 0,
                y: 0,
                z: 0,
            };
            this.hascurrentcard = false;
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
        },
        addfirstcart(i){
            if(this.cpos.x == 3){
                if(this.gamearr[i].length === 0 && this.hascurrentcard && this.gamearr[this.cpos.y][this.cpos.z].pos === 12){
                    if(this.gamearr[this.cpos.y][this.cpos.z-1] !== undefined){
                        this.gamearr[this.cpos.y][this.cpos.z-1].show = true;
                    }
                    let thislen = this.gamearr[this.cpos.y].length;
                    let pushing = this.gamearr[this.cpos.y].splice(this.cpos.z, thislen+1);
                    this.gamearr[i].push(...pushing);
                    this.gamearr[this.cpos.y].slice(0, this.cpos.z);
                    
                    this.clearcurrent();
                }
            }else if(this.cpos.x == 1){
                if(this.gamearr[i].length === 0 && this.hascurrentcard && this.choicearr[1][this.cpos.z].pos === 12){
                    this.gamearr[i].push(this.choicearr[1][this.cpos.z]);
                    if(this.choicearr[1][this.cpos.z-1] !== undefined){
                        this.choicearr[1][this.cpos.z-1].show = true;
                    }
                    this.choicearr[1].pop();
                    this.clearcurrent();
                }
            }
        },
        fullgamearr(){
            let a = 0;
            for(let i=0;i<7;i++){
                for(let j=0; j<i+1;j++){
                    this.gamearr[i].push({...this.carts[a], show: j==i});
                    a++;
                }
            }
            for(let i=a;i<52;i++){
                this.choicearr[0].push({...this.carts[i], show: true});
            }
        },
        activethis(e, b){
            if(!b) return;
            const element = e.target.parentElement;
            const x = parseInt(element.getAttribute('data-x'));
            const y = parseInt(element.getAttribute('data-y'));
            const z = parseInt(element.getAttribute('data-z'));
            if(!this.hascurrentcard){
                element.classList.add('active');
                this.cpos = {
                    x,
                    y,
                    z,
                };
                if(x == 3){
                    this.currentcard = this.gamearr[y][z];
                }else if(x == 1){
                    this.currentcard = this.choicearr[1][z];
                }
                this.hascurrentcard = true;
            }else{
                if(!(this.cpos.x === x && this.cpos.y === y && this.cpos.z === z)){
                    if(this.cpos.x == 3){
                        if(this.gamearr[this.cpos.y][this.cpos.z].clr !== this.gamearr[y][z].clr 
                        && this.gamearr[this.cpos.y][this.cpos.z].pos-this.gamearr[y][z].pos===-1 || this.gamearr[y] == [] 
                        || ( this.gamearr[y] == [] && this.gamearr[this.cpos.y][this.cpos.z].pos==12)){

                            if(this.gamearr[this.cpos.y][this.cpos.z-1] !== undefined){
                                this.gamearr[this.cpos.y][this.cpos.z-1].show = true;
                            }
                            let thislen = this.gamearr[this.cpos.y].length;
                            let pushing = this.gamearr[this.cpos.y].splice(this.cpos.z, thislen+1);
                            this.gamearr[y].push(...pushing);
                            this.gamearr[this.cpos.y].slice(0, this.cpos.z);

                        }
                    }else if(this.cpos.x == 1){
                        if(this.choicearr[1][this.cpos.z].clr !== this.gamearr[y][z].clr 
                        && this.choicearr[1][this.cpos.z].pos-this.gamearr[y][z].pos===-1 || this.gamearr[y] == [] 
                        || ( this.gamearr[y] == [] && this.choicearr[1][this.cpos].pos==12)){
                            this.gamearr[y].push(this.choicearr[1][this.cpos.z]);
                            this.choicearr[1].pop();
                        }

                    }
                }
                element.classList.remove('active');
                this.clearcurrent();
            }
        },
        completethis(e){
            if(this.hascurrentcard){
                let element;
                if(e.target.classList[0] === 'card-outline'){
                    element = e.target.querySelector('.card');
                }else if(e.target.classList.length === 0){
                    element = e.target.parentElement;
                }
                const x = element.getAttribute('data-x');
                const y = element.getAttribute('data-y');
                const z = element.getAttribute('data-z');
                if(!(this.cpos.x === x && this.cpos.y === y && this.cpos.z === z)){
                    // console.log(x, y, z);
                    if(this.cpos.x == 3){
                        if( 
                            (this.conmpletaarr[y].length == 0 && this.gamearr[this.cpos.y][this.cpos.z].pos===0)
                          || this.conmpletaarr[y][z-1] !== undefined &&
                            (this.gamearr[this.cpos.y][this.cpos.z].clr === this.conmpletaarr[y][z-1].clr) 
                         && (this.gamearr[this.cpos.y][this.cpos.z].img[0] == this.conmpletaarr[y][z-1].img[0])
                         && (this.gamearr[this.cpos.y][this.cpos.z].pos - this.conmpletaarr[y][z-1].pos===1) ){

                            this.conmpletaarr[y].push(this.gamearr[this.cpos.y][this.cpos.z]);
                            if(this.gamearr[this.cpos.y][this.cpos.z-1] !== undefined){
                                this.gamearr[this.cpos.y][this.cpos.z-1].show = true;
                            }
                            this.gamearr[this.cpos.y].pop();
                            this.clearcurrent();
                        }
                    }else if(this.cpos.x == 1){
                        if( ( this.conmpletaarr[y].length == 0 && this.choicearr[1][this.cpos.z].pos===0)
                        ||this.conmpletaarr[y][z-1] !== undefined &&
                        (this.choicearr[1][this.cpos.z].clr === this.conmpletaarr[y][z-1].clr 
                        && this.choicearr[1][this.cpos.z].pos - this.conmpletaarr[y][z-1].pos===1) ){
                            this.conmpletaarr[y].push(this.choicearr[1][this.cpos.z]);
                            if(this.choicearr[1][this.cpos.z-1] !== undefined){
                                this.choicearr[1][this.cpos.z-1].show = true;
                            }
                            this.choicearr[1].pop();
                            this.clearcurrent();
                        }
                    }
                }
            }
        }
    },
    created(){
        this.carts = this.shufflegame(this.carts);
        this.fullgamearr();
    },
    computed: {
        choiceincart: {
            get(){
                return this.choicearr[1][this.choicearr[1].length-1];
            }
        },
        winnerthegame: {
            get(){
                for(let i=0;i<7;i++){
                    for(let j=0; j<this.gamearr[i].length;j++){
                        if(this.gamearr[i][j]&&!this.gamearr[i][j].show) return false;
                    }
                }
                return true;
            }
        }
    }
});